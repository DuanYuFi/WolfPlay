{"remainingRequest":"/home/duanyufi/Web/flower/front/node_modules/babel-loader/lib/index.js!/home/duanyufi/Web/flower/front/node_modules/eslint-loader/index.js??ref--13-0!/home/duanyufi/Web/flower/front/src/utils/request.js","dependencies":[{"path":"/home/duanyufi/Web/flower/front/src/utils/request.js","mtime":1602324829182},{"path":"/home/duanyufi/Web/flower/front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/duanyufi/Web/flower/front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/duanyufi/Web/flower/front/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCB7IHN0b3JlIH0gZnJvbSAnQC9zdG9yZS9pbmRleCc7CnZhciBzZXJ2aWNlID0gYXhpb3MuY3JlYXRlKHsKICBiYXNlVVJMOiBwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJLAogIHRpbWVvdXQ6IDk5OTk5Cn0pOwp2YXIgYWNpdHZlQXhpb3MgPSAwOwp2YXIgbG9hZGluZ0luc3RhbmNlOwp2YXIgdGltZXI7Cgp2YXIgc2hvd0xvYWRpbmcgPSBmdW5jdGlvbiBzaG93TG9hZGluZygpIHsKICBhY2l0dmVBeGlvcysrOwoKICBpZiAodGltZXIpIHsKICAgIGNsZWFyVGltZW91dCh0aW1lcik7CiAgfQoKICB0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgLyogaWYgKGFjaXR2ZUF4aW9zID4gMCkgewogICAgICBsb2FkaW5nSW5zdGFuY2UgPSBMb2FkaW5nLnNlcnZpY2UoeyBmdWxsc2NyZWVuOiB0cnVlIH0pCiAgICB9ICovCiAgfSwgNDAwKTsKfTsKCnZhciBjbG9zZUxvYWRpbmcgPSBmdW5jdGlvbiBjbG9zZUxvYWRpbmcoKSB7CiAgYWNpdHZlQXhpb3MtLTsKCiAgaWYgKGFjaXR2ZUF4aW9zIDw9IDApIHsKICAgIGNsZWFyVGltZW91dCh0aW1lcik7CiAgICBsb2FkaW5nSW5zdGFuY2UgJiYgbG9hZGluZ0luc3RhbmNlLmNsb3NlKCk7CiAgfQp9OyAvLyBodHRwIHJlcXVlc3Qg5oum5oiq5ZmoCgoKc2VydmljZS5pbnRlcmNlcHRvcnMucmVxdWVzdC51c2UoZnVuY3Rpb24gKGNvbmZpZykgewogIHNob3dMb2FkaW5nKCk7IC8vIGNvbnNvbGUubG9nKCdodHRwIHJlc3F1ZXN0IHRlc3QnKQoKICB2YXIgdG9rZW4gPSBzdG9yZS5nZXR0ZXJzWyd1c2VyL3Rva2VuJ107CiAgY29uZmlnLmRhdGEgPSBKU09OLnN0cmluZ2lmeShjb25maWcuZGF0YSk7CiAgY29uZmlnLmhlYWRlcnMgPSB7CiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgJ3gtdG9rZW4nOiB0b2tlbgogIH07CiAgcmV0dXJuIGNvbmZpZzsKfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgY2xvc2VMb2FkaW5nKCk7CiAgLyogTWVzc2FnZSh7CiAgICBzaG93Q2xvc2U6IHRydWUsCiAgICBtZXNzYWdlOiBlcnJvciwKICAgIHR5cGU6ICdlcnJvcicKICB9KSAqLwoKICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwp9KTsgLy8gaHR0cCByZXNwb25zZSDmi6bmiKrlmagKCnNlcnZpY2UuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICBjbG9zZUxvYWRpbmcoKTsKCiAgaWYgKHJlc3BvbnNlLmRhdGEuY29kZSA9PT0gMCB8fCByZXNwb25zZS5oZWFkZXJzLnN1Y2Nlc3MgPT09ICd0cnVlJykgewogICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgfSBlbHNlIHsKICAgIGlmIChyZXNwb25zZS5kYXRhLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5kYXRhLnJlbG9hZCkgewogICAgICBzdG9yZS5jb21taXQoJ3VzZXIvTG9naW5PdXQnKTsKICAgIH0KCiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QocmVzcG9uc2UuZGF0YS5tc2cpOwogIH0KfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgY2xvc2VMb2FkaW5nKCk7CiAgY29uc29sZS5sb2coJ2h0dHAgcmVzcG9uc2UgdGVzdCBlcnJvcicpOwogIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7Cn0pOwpleHBvcnQgZGVmYXVsdCBzZXJ2aWNlOw=="},{"version":3,"sources":["/home/duanyufi/Web/flower/front/src/utils/request.js"],"names":["axios","store","service","create","baseURL","process","env","VUE_APP_BASE_API","timeout","acitveAxios","loadingInstance","timer","showLoading","clearTimeout","setTimeout","closeLoading","close","interceptors","request","use","config","token","getters","data","JSON","stringify","headers","error","Promise","reject","response","code","success","reload","commit","msg","console","log"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,KAAT,QAAsB,eAAtB;AACA,IAAMC,OAAO,GAAGF,KAAK,CAACG,MAAN,CAAa;AAC3BC,EAAAA,OAAO,EAAEC,OAAO,CAACC,GAAR,CAAYC,gBADM;AAE3BC,EAAAA,OAAO,EAAE;AAFkB,CAAb,CAAhB;AAIA,IAAIC,WAAW,GAAG,CAAlB;AACA,IAAIC,eAAJ;AACA,IAAIC,KAAJ;;AACA,IAAMC,WAAW,GAAG,SAAdA,WAAc,GAAM;AACxBH,EAAAA,WAAW;;AACX,MAAIE,KAAJ,EAAW;AACTE,IAAAA,YAAY,CAACF,KAAD,CAAZ;AACD;;AACDA,EAAAA,KAAK,GAAGG,UAAU,CAAC,YAAM;AACvB;;;AAGD,GAJiB,EAIf,GAJe,CAAlB;AAKD,CAVD;;AAYA,IAAMC,YAAY,GAAG,SAAfA,YAAe,GAAM;AACzBN,EAAAA,WAAW;;AACX,MAAIA,WAAW,IAAI,CAAnB,EAAsB;AACpBI,IAAAA,YAAY,CAACF,KAAD,CAAZ;AACAD,IAAAA,eAAe,IAAIA,eAAe,CAACM,KAAhB,EAAnB;AACD;AACF,CAND,C,CAOA;;;AACAd,OAAO,CAACe,YAAR,CAAqBC,OAArB,CAA6BC,GAA7B,CACE,UAAAC,MAAM,EAAI;AACRR,EAAAA,WAAW,GADH,CAER;;AACA,MAAMS,KAAK,GAAGpB,KAAK,CAACqB,OAAN,CAAc,YAAd,CAAd;AACAF,EAAAA,MAAM,CAACG,IAAP,GAAcC,IAAI,CAACC,SAAL,CAAeL,MAAM,CAACG,IAAtB,CAAd;AACAH,EAAAA,MAAM,CAACM,OAAP,GAAiB;AACf,oBAAgB,kBADD;AAEf,eAAWL;AAFI,GAAjB;AAIA,SAAOD,MAAP;AACD,CAXH,EAYE,UAAAO,KAAK,EAAI;AACPZ,EAAAA,YAAY;AACZ;;;;;;AAKA,SAAOa,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACD,CApBH,E,CAuBA;;AACAzB,OAAO,CAACe,YAAR,CAAqBa,QAArB,CAA8BX,GAA9B,CACE,UAAAW,QAAQ,EAAI;AACVf,EAAAA,YAAY;;AACZ,MAAIe,QAAQ,CAACP,IAAT,CAAcQ,IAAd,KAAuB,CAAvB,IAA4BD,QAAQ,CAACJ,OAAT,CAAiBM,OAAjB,KAA6B,MAA7D,EAAqE;AACnE,WAAOF,QAAQ,CAACP,IAAhB;AACD,GAFD,MAEO;AACL,QAAIO,QAAQ,CAACP,IAAT,CAAcA,IAAd,IAAsBO,QAAQ,CAACP,IAAT,CAAcA,IAAd,CAAmBU,MAA7C,EAAqD;AACnDhC,MAAAA,KAAK,CAACiC,MAAN,CAAa,eAAb;AACD;;AACD,WAAON,OAAO,CAACC,MAAR,CAAeC,QAAQ,CAACP,IAAT,CAAcY,GAA7B,CAAP;AACD;AACF,CAXH,EAYE,UAAAR,KAAK,EAAI;AACPZ,EAAAA,YAAY;AACZqB,EAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ;AACA,SAAOT,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACD,CAhBH;AAmBA,eAAezB,OAAf","sourcesContent":["import axios from 'axios'\nimport { store } from '@/store/index'\nconst service = axios.create({\n  baseURL: process.env.VUE_APP_BASE_API,\n  timeout: 99999\n})\nlet acitveAxios = 0\nlet loadingInstance\nlet timer\nconst showLoading = () => {\n  acitveAxios++\n  if (timer) {\n    clearTimeout(timer)\n  }\n  timer = setTimeout(() => {\n    /* if (acitveAxios > 0) {\n      loadingInstance = Loading.service({ fullscreen: true })\n    } */\n  }, 400)\n}\n\nconst closeLoading = () => {\n  acitveAxios--\n  if (acitveAxios <= 0) {\n    clearTimeout(timer)\n    loadingInstance && loadingInstance.close()\n  }\n}\n// http request 拦截器\nservice.interceptors.request.use(\n  config => {\n    showLoading()\n    // console.log('http resquest test')\n    const token = store.getters['user/token']\n    config.data = JSON.stringify(config.data)\n    config.headers = {\n      'Content-Type': 'application/json',\n      'x-token': token\n    }\n    return config\n  },\n  error => {\n    closeLoading()\n    /* Message({\n      showClose: true,\n      message: error,\n      type: 'error'\n    }) */\n    return Promise.reject(error)\n  }\n)\n\n// http response 拦截器\nservice.interceptors.response.use(\n  response => {\n    closeLoading()\n    if (response.data.code === 0 || response.headers.success === 'true') {\n      return response.data\n    } else {\n      if (response.data.data && response.data.data.reload) {\n        store.commit('user/LoginOut')\n      }\n      return Promise.reject(response.data.msg)\n    }\n  },\n  error => {\n    closeLoading()\n    console.log('http response test error')\n    return Promise.reject(error)\n  }\n)\n\nexport default service\n"]}]}